---
sidebar_position: 4
---

# 一般的な慣行：ユーザーテーブルは必要ありません

## ユーザーの特定

私たちは、各ユーザーが一意であり、`id`が`null`でないことを確認しているため、ユーザーを特定するために`user.id`プロパティを利用することを提案します。さらに、`username`、`primary_email`、`primary_phone`のプロパティはユニークですが、空の場合があります。したがって、これらのプロパティをユーザーの識別子として使用する場合は、`null`の値を適切に処理することが重要です。

## なぜユーザーテーブルの準備をスキップするのですか？

Logtoをアイデンティティソリューションとして使用する場合、ユーザー情報と関連データの整理方法を検討することが重要です。これには、ユーザーオブジェクトの構造とプロパティを決定するユーザースキーマの定義、およびユーザー関連データの保存と管理方法の決定が含まれます。

過去に、開発者がユーザーのプロフィールや関連情報を保存するためにSQLデータベースにユーザーテーブルを作成し、その後、他のテーブルで多対一の関係を確立するために`user`列をユーザーテーブルに戻すようなアプローチが一般的でした。また、Googleなどの他のアイデンティティプロバイダーでは、"Googleでサインイン"機能を有効にするために`google_id`列の作成が必要でした。ただし、Logtoには，サービスプロバイダーだけでなく，アイデンティティプロバイダーでもあるため，このアプローチは適切ではありません。Logtoは識別子、ソーシャルコネクション、カスタムデータなどを含むすべてのユーザー関連情報を管理できる包括的なソリューションです。したがって、`logto_id`列の作成は効果的な戦略ではありません。

Logtoの使用により、ユーザーテーブルが不要になります。

ユーザーテーブルを忘れて、ユーザー情報をLogtoに保存してください。以下は一般的な慣行です：

1. 他のテーブルに`user_id`列を作成し、Logtoの`user.id`の値を保存します。詳細については、[ユーザーの特定](#identify-user)の前の章を参照してください。
2. [Logtoの管理API](./management-api.md)を使用して、ユーザーの作成や更新、ユーザーの詳細の取得、ユーザーのリストアップなどのCRUD操作を行います。
3. 任意の追加ユーザー情報はカスタムデータに保存します。詳細については、[ユーザーカスタムデータ](../../references/users/custom-data.md)を参照してください。

これらの方法を使用することで、Logtoは実質的に「ユーザーテーブル」の役割を果たします。

たとえば、Logtoをアイデンティティサービスとして使用する「オンラインストア」アプリケーションを考えてみましょう。次の2つの機能を実装したい場合

1. ユーザーの選好データをクラウドに保存
2. 異なるユーザーグループのアクセス制御を実装

Logtoはこれらのタスクの両方を容易に行えます。

カスタムデータを利用することで、これを素早く実装でき、データオブジェクトは次のようになります：

```json
{
  "appearenceMode": "ダークモード",
  "role": "顧客"
}
```

:::注意
Logtoのユーザーストレージでは「結合」やその他の複雑なクエリは実行できません。この場合は、キャッシュレイヤーまたは独自のユーザーテーブルを使用する必要があります。
:::